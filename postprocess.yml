# DEFINING A TASK:
# Order of operation:
#   1) selectors: Select objects to be processed
#      - func(ssafile, **kwargs) -> obj
#   2) filter: filter out object from selectors
#      - func(ssafile, item, **kwargs) -> bool
#   3) actions: run actions for each item that was selected
#      - func(ssafile, item, **kwargs) -> output
#   4) run misc function
#      - func(ssafile,**kwargs) -> output
#
#  defining id saves the output of an action to a dict: outputs
#  the value can be accessed using: {{outputs['id'][0]['PlayResX']}}
#

ass:
  tasks:
    - selectors:
        - uses: info_select_current_info

      actions:
        - uses: info_action_save
          id: old_info

        - uses: info_action_update
          id: info
          with:
            ScaledBorderAndShadow: "yes"
            PlayResX: 1920
            PlayResY: 1080

    - selectors:
        - uses: styles_select_all
      actions:
        - uses: styles_action_scale
          with:
            x_old: "{{outputs['old_info'][0]['PlayResX']}}"
            y_old: "{{outputs['old_info'][0]['PlayResY']}}"
            x_new: "{{outputs['info'][0]['PlayResX']}}"
            y_new: "{{outputs['info'][0]['PlayResY']}}"

    - selectors:
        - uses: styles_select_top
      actions:
        - uses: styles_action_update
          with:
            fontname: "Arial"
            borderstyle: 1
            outline: 1
            shadow: 1
            fontsize: 60
            marginl: 30
            marginr: 30
            marginv: 50

    - selectors:
        - uses: events_select_all

      actions:
        - uses: events_action_scale
          with:
            x_old: "{{outputs['old_info'][0]['PlayResX']}}"
            y_old: "{{outputs['old_info'][0]['PlayResY']}}"
            x_new: "{{outputs['info'][0]['PlayResX']}}"
            y_new: "{{outputs['info'][0]['PlayResY']}}"

    - misc:
        - uses: "events_misc_remove_miscellaneous_events"

srt:
  tasks:
    - selectors:
        - uses: events_select_all

      filters:
        - uses: "events_filter_regex"
          with:
            regex: ".*"

      actions:
        - uses: "events_action_regex_substitution"
          with:
            regex: '{\\an\d}'
            replace: "[+] "

    - misc:
        - uses: "events_misc_remove_miscellaneous_events"
